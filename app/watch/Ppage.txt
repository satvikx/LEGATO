"use client";

import { useState, useEffect } from "react";
// import { useRouter } from "next/navigation";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { ChevronLeft, ChevronRight } from "lucide-react";
import { IVideo } from "@/models/Video";
import VideoComponent from "../components/VideoComponent";


// interface VideoData {
//   videos: IVideo[];
// }

export default function WatchPage() {
  const [videos, setVideos] = useState<IVideo[]>([]);
  const [currentIndex, setCurrentIndex] = useState(0);
//   const router = useRouter();

  useEffect(() => {
    async function fetchVideos() {
      try {
        const response = await fetch("/api/videos");
        const data = await response.json();
        setVideos(data);
        console.log("Fetched videos:", data);  
      } catch (error) {
        console.error("Error fetching videos:", error);
      }
    }
    fetchVideos();
  }, []);

  const nextVideo = () => {
    if (currentIndex < videos.length - 1) {
      setCurrentIndex(currentIndex + 1);
    }
  };

  const prevVideo = () => {
    if (currentIndex > 0) {
      setCurrentIndex(currentIndex - 1);
    }
  };

  if (!videos.length) {
    return <p className="text-center text-gray-500">Loading videos...</p>;
  }

  const currentVideo = videos[currentIndex];

  return (
    <div className="flex flex-col items-center justify-center p-6 min-h-screen bg-gray-900 text-white">
      <h1 className="text-2xl font-bold mb-4">Watch & Learn</h1>
      <Card className="w-full max-w-6xl flex gap-4 bg-gray-800 p-4 rounded-2xl shadow-lg">
        {/* Video Section */}
        <CardContent className="w-1/2">
          <VideoComponent key={currentVideo._id?.toString()} video={currentVideo} />
        </CardContent>

        {/* PDF Section */}
        <CardContent className="w-1/2">
        <iframe
        src={`https://ik.imagekit.io/satvik/${currentVideo.pdfUrl}`} 
        className="w-full h-[400px] border rounded-lg shadow-md"
        />

    {/* </iframe> */}
        </CardContent>
      </Card>

      {/* Navigation Controls */}
      <div className="flex justify-between w-full max-w-6xl mt-4">
        <Button
          onClick={prevVideo}
          disabled={currentIndex === 0}
          className="flex items-center gap-2"
        >
          <ChevronLeft /> Previous
        </Button>
        <Button
          onClick={nextVideo}
          disabled={currentIndex === videos.length - 1}
          className="flex items-center gap-2"
        >
          Next <ChevronRight />
        </Button>
      </div>
    </div>
  );
}
